(()=>{"use strict";function e(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function t(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}function n(n,o){var r=Array.from(n.querySelectorAll(o.inputSelector));r.forEach((function(t){return e(n,t,o)})),t(r,n.querySelector(o.submitButtonSelector),o)}function o(e){e.classList.add("popup_opened"),document.addEventListener("keydown",c)}function r(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",c)}function c(e){"Escape"===e.key&&r(document.querySelector(".popup_opened"))}function a(e){e.target.classList.contains("popup_opened")&&r(document.querySelector(".popup_opened"))}var u=document.getElementById("popup-profile"),s=document.querySelector(".profile"),i=s.querySelector(".profile__name"),l=s.querySelector(".profile__profession"),d=s.querySelector(".profile__photo"),p=document.getElementById("popup-avatar"),m="",f=document.getElementById("popup-card"),_=document.getElementById("popup-agree"),h=document.querySelector("#card").content,y=document.querySelector(".elements__list"),v=document.getElementById("popup-image"),S=v.querySelector(".popup__caption"),E=v.querySelector(".popup__picture"),g=document.querySelector(".button_type_agree");function q(e,t,n,c,a){var u=function(e,t,n,c,a){var u=h.querySelector(".elements__element").cloneNode(!0),s=u.querySelector(".elements__image"),i=u.querySelector(".elements__number");return u.querySelector(".elements__text").textContent=e,u.id=a,s.src=t,s.alt=e,s.addEventListener("click",(function(){var n,r,c;o(v),n=t,r=e,c=e,S.textContent=r,E.src=n,E.alt=c})),i.textContent=n.length?n.length:0,u.querySelector(".elements__like").addEventListener("click",(function(e){e.target.classList.contains("elements__like_active")?(P(e),i.textContent=n.length):(B(e),i.textContent=n.length+1),e.target.classList.toggle("elements__like_active")})),c._id!==m&&u.querySelector(".elements__delete").classList.add("elements__delete_show_remove"),u.querySelector(".elements__delete").addEventListener("click",(function(e){o(_),g.addEventListener("click",(function(){x(e),u.remove(),r(_)}))})),u}(e,t,n,c,a);y.insertAdjacentElement("afterbegin",u)}var b,k=document.querySelector(".button_type_save"),L={baseUrl:"https://nomoreparties.co/v1/plus-cohort-15",headers:{authorization:"bfe9fc91-7210-42ab-9043-e5db917b2ecc","Content-Type":"application/json"}},C=function(){return fetch("".concat(L.baseUrl,"/cards"),{headers:L.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){!function(e,t){e.map((function(e){t(e.name,e.link,e.likes,e.owner,e._id)}))}(e.reverse(),q)})).catch((function(e){console.log(e.message)}))},j=function(){return fetch("".concat(L.baseUrl,"/users/me"),{headers:L.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){!function(e,t,n,o){i.textContent=e,l.textContent=t,d.src=n,m=o}(e.name,e.about,e.avatar,e._id)})).catch((function(e){console.log(e.message)})).finally((function(){k.textContent="Сохранить"}))},x=function(e){return fetch("https://nomoreparties.co/v1/plus-cohort-15/cards/".concat(e.target.parentElement.id),{method:"DELETE",headers:L.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))},B=function(e){var t=e.target.parentElement.parentElement.parentElement;return fetch("".concat(L.baseUrl,"/cards/likes/").concat(t.id),{method:"PUT",headers:L.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))},P=function(e){var t=e.target.parentElement.parentElement.parentElement;return fetch("".concat(L.baseUrl,"/cards/likes/").concat(t.id),{method:"DELETE",headers:L.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))},A=document.querySelectorAll(".popup"),U=p.querySelector(".popup__form").querySelector(".popup__item_el_avatar"),I=u.querySelector(".popup__form"),T=I.querySelector(".popup__item_el_name"),w=s.querySelector(".profile__avatar"),D=u.querySelector(".popup__item_el_profession"),N=f.querySelector(".popup__item_el_name"),O=f.querySelector(".popup__item_el_profession"),J=f.querySelector(".popup__form"),M=document.querySelector(".button_type_add"),H=document.querySelectorAll(".button_type_close"),V=document.querySelector(".button_type_edit"),z={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".button_type_save",inactiveButtonClass:"button_type_save_inactive",inputErrorClass:"popup__item_type_error",errorClass:"popup__item-error_active"};C(),j(),b=z,Array.from(document.querySelectorAll(b.formSelector)).forEach((function(n){!function(n,o){var r=Array.from(n.querySelectorAll(o.inputSelector)),c=n.querySelector(o.submitButtonSelector);t(r,c,o),r.forEach((function(a){a.addEventListener("input",(function(){!function(t,n,o){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?e(t,n,o):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,n,n.validationMessage,o)}(n,a,o),t(r,c,o)}))}))}(n,b)})),A.forEach((function(e){e.addEventListener("mousedown",a)})),H.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){r(t)}))})),V.addEventListener("click",(function(){document.getElementById("name-input").value=i.textContent,document.getElementById("profession-input").value=l.textContent,n(u,z),o(u)})),M.addEventListener("click",(function(){n(f,z),o(f)})),w.addEventListener("click",(function(){n(p,z),o(p)})),I.addEventListener("submit",(function(e){e.preventDefault(),function(e,t){fetch("".concat(L.baseUrl,"/users/me"),{method:"PATCH",headers:L.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?(k.textContent="Сохранение...",e.json()):Promise.reject("Ошибка ".concat(e.status))})).then((function(e){j()})).catch((function(e){console.log(e)}))}(T.value,D.value),j().then((function(){r(u)}))})),p.addEventListener("submit",(function(e){e.preventDefault(),function(e){var t;t=e,fetch("".concat(L.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:L.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){console.log(e)})).catch((function(e){console.log(e)})),d.src=e,r(p)}(U.value)})),J.addEventListener("submit",(function(e){e.preventDefault(),function(e,t){fetch("".concat(L.baseUrl,"/cards"),{method:"POST",headers:L.headers,body:JSON.stringify({name:e,link:t,likes:[]})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){q(e.name,e.link,e.likes,e.owner),C()})).catch((function(e){console.error("Error",e)}))}(N.value,O.value),e.target.reset(),r(f)}))})();