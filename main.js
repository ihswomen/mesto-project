(()=>{"use strict";function e(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function t(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}function n(n,o){var r=Array.from(n.querySelectorAll(o.inputSelector));r.forEach((function(t){return e(n,t,o)})),t(r,n.querySelector(o.submitButtonSelector),o)}var o={baseUrl:"https://nomoreparties.co/v1/plus-cohort-15",headers:{authorization:"bfe9fc91-7210-42ab-9043-e5db917b2ecc","Content-Type":"application/json"}};function r(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}var c=function(){return fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then(r)},a=function(){return fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then(r)};function s(e){e.classList.add("popup_opened"),document.addEventListener("keydown",l)}function i(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",l)}function l(e){"Escape"===e.key&&i(document.querySelector(".popup_opened"))}var u=document.getElementById("popup-profile"),d=document.querySelector(".profile"),p=d.querySelector(".profile__name"),m=d.querySelector(".profile__profession"),_=d.querySelector(".profile__photo"),f=document.getElementById("popup-avatar"),h=document.querySelector(".button_type_save"),v="",y=function(e,t,n,o){p.textContent=e,m.textContent=t,_.src=n,v=o};var S=document.querySelector("#popup-card"),g=document.querySelector("#popup-agree"),q=document.querySelector("#card").content,E=document.querySelector(".elements__list"),b=document.querySelector("#popup-image"),L=b.querySelector(".popup__caption"),k=b.querySelector(".popup__picture"),C=document.querySelector(".button_type_agree");function x(e,t,n,c,a){var l=function(e,t,n,c,a){var l=q.querySelector(".elements__element").cloneNode(!0),u=l.querySelector(".elements__image"),d=l.querySelector(".elements__number"),p=l.querySelector(".elements__like");return l.querySelector(".elements__text").textContent=e,l.id=a,u.src=t,u.alt=e,u.addEventListener("click",(function(){var n,o,r;s(b),n=t,o=e,r=e,L.textContent=o,k.src=n,k.alt=r})),d.textContent=n.length?n.length:0,n.forEach((function(e){e._id==v&&p.classList.add("elements__like_active")})),l.querySelector(".elements__like").addEventListener("click",(function(e){e.target.classList.contains("elements__like_active")?function(e){var t=e.target.parentElement.parentElement.parentElement;return fetch("".concat(o.baseUrl,"/cards/likes/").concat(t.id),{method:"DELETE",headers:o.headers}).then(r)}(e).then((function(t){d.textContent=t.likes.length,e.target.classList.toggle("elements__like_active")})).catch((function(e){console.log(e)})):function(e){var t=e.target.parentElement.parentElement.parentElement;return fetch("".concat(o.baseUrl,"/cards/likes/").concat(t.id),{method:"PUT",headers:o.headers}).then(r)}(e).then((function(t){console.log(t.likes),d.textContent=t.likes.length,e.target.classList.toggle("elements__like_active")})).catch((function(e){console.log(e)}))})),c._id!==v&&l.querySelector(".elements__delete").classList.add("elements__delete_show_remove"),l.querySelector(".elements__delete").addEventListener("click",(function(e){s(g),C.addEventListener("click",(function(){(function(e){return fetch("https://nomoreparties.co/v1/plus-cohort-15/cards/".concat(e.target.parentElement.id),{method:"DELETE",headers:o.headers}).then(r)})(e).then((function(e){console.log(e),l.remove(),i(g)})).catch((function(e){console.log(e)}))}))})),l}(e,t,n,c,a);E.insertAdjacentElement("afterbegin",l)}function A(e,t){e.map((function(e){t(e.name,e.link,e.likes,e.owner,e._id)}))}var U,B=document.querySelectorAll(".popup"),T=f.querySelector(".popup__form").querySelector(".popup__item_el_avatar"),w=u.querySelector(".popup__form"),D=w.querySelector(".popup__item_el_name"),P=d.querySelector(".profile__avatar"),j=u.querySelector(".popup__item_el_profession"),N=S.querySelector(".popup__item_el_name"),O=S.querySelector(".popup__item_el_profession"),J=S.querySelector(".popup__form"),M=document.querySelector(".button_type_add"),H=document.querySelector(".button_type_edit"),I={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".button_type_save",inactiveButtonClass:"button_type_save_inactive",inputErrorClass:"popup__item_type_error",errorClass:"popup__item-error_active"};c().then((function(e){A(e.reverse(),x)})).catch((function(e){console.log(e.message)})),a().then((function(e){y(e.name,e.about,e.avatar,e._id)})).catch((function(e){console.log(e.message)})),U=I,Array.from(document.querySelectorAll(U.formSelector)).forEach((function(n){!function(n,o){var r=Array.from(n.querySelectorAll(o.inputSelector)),c=n.querySelector(o.submitButtonSelector);t(r,c,o),r.forEach((function(a){a.addEventListener("input",(function(){!function(t,n,o){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?e(t,n,o):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,n,n.validationMessage,o)}(n,a,o),t(r,c,o)}))}))}(n,U)})),B.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&function(e){i(e.target)}(t),t.target.classList.contains("button_type_close")&&i(e)}))})),H.addEventListener("click",(function(){D.value=p.textContent,j.value=m.textContent,n(u,I),s(u)})),M.addEventListener("click",(function(){n(S,I),s(S)})),P.addEventListener("click",(function(){n(f,I),s(f)})),w.addEventListener("submit",(function(e){var t,n;e.preventDefault(),t=D.value,n=j.value,function(e,t){return fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:e,about:t})}).then(r)}(t,n).then((function(e){h.textContent="Сохранение...",a().then((function(e){y(e.name,e.about,e.avatar,e._id)})).then((function(){i(u)})).catch((function(e){console.log(e.message)})).finally((function(){h.textContent="Сохранить"}))})).catch((function(e){console.log(e.message)}))})),f.addEventListener("submit",(function(e){e.preventDefault(),function(e){var t;(t=e,fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:t})}).then(r)).then((function(t){_.src=e,i(f)})).catch((function(e){console.log(e)}))}(T.value)})),J.addEventListener("submit",(function(e){e.preventDefault(),function(e,t){return fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify({name:e,link:t,likes:[]})}).then(r)}(N.value,O.value).then((function(e){x(e.name,e.link,e.likes,e.owner),c().then((function(e){A(e.reverse(),x)})).catch((function(e){console.log(e.message)}))})).catch((function(e){console.error("Error",e)})),e.target.reset(),i(S)}))})();